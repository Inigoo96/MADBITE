<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard – MADBITE</title>

  <!-- Scripts en orden correcto con defer para mejor rendimiento -->
  <!-- Asegurarnos de cargar primero jwt-decode -->
  <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
  <script src="../js/auth.js" defer></script>
  <script src="../js/auth-guard.js" defer></script>
  <script src="../js/dashboard.js" defer></script>

  <!-- Cargar Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <!-- Estilos CSS -->
  <link rel="stylesheet" href="../css/main.css" />


</head>
<body>
<header class="header">
  <div class="nav-container">
    <!-- Logo -->
    <div class="logo-container">
      <a href="../index.html" class="logo-link" aria-label="MADBITE Home">
        <img src="../assets/images/logo/logo-completo-ajustadorbg.png" alt="MADBITE Logo" class="logo logo-intact"/>
        <img src="../assets/images/logo/logo-neon-ajustadorbg.png" alt="MADBITE Logo Animation Frame 1" class="logo logo-bitten-1"/>
        <img src="../assets/images/logo/logo-bitten-3-rp (1)-Photoroom.png" alt="MADBITE Logo Animation Frame 2" class="logo logo-bitten-2"/>
        <img src="../assets/images/logo/logo-bitten-4-rp (1)-Photoroom.png" alt="MADBITE Logo Animation Frame 3" class="logo logo-bitten-3"/>
      </a>
    </div>

    <!-- Sidebar collapse toggle (desktop) -->
    <button id="sidebarToggle" class="sidebar-toggle" aria-label="Toggle sidebar">
      <span class="bar"></span><span class="bar"></span><span class="bar"></span>
    </button>

    <!-- Mobile menu toggle -->
    <button id="menuToggle" class="menu-toggle" aria-label="Toggle menu">
      <span class="bar"></span><span class="bar"></span><span class="bar"></span>
    </button>

    <nav id="sidebar" class="nav-menu" aria-label="Main navigation">
      <ul class="nav-list">
        <li class="nav-item active"><a href="redireccion.html">Dashboard</a></li>
        <li class="nav-item"><a href="menu.html">Menu</a></li>
        <li class="nav-item"><a href="comite.html">Committee</a></li>
        <li class="nav-item language-dropdown-container">
          <div class="language-selector">
            <div class="selected-language">
              <span>English</span>
              <img src="../assets/images/flags/uk.png" alt="English" class="flag-icon"/>
              <i class="fas fa-chevron-down"></i>
            </div>
            <ul class="language-dropdown">
              <li class="language-option" data-lang="es"><img src="../assets/images/flags/españa.png" alt="Español" class="flag-icon"/><span>Español</span></li>
              <li class="language-option active" data-lang="en"><img src="../assets/images/flags/uk.png" alt="English" class="flag-icon"/><span>English</span></li>
              <li class="language-option" data-lang="fr"><img src="../assets/images/flags/francia.png" alt="Français" class="flag-icon"/><span>Français</span></li>
            </ul>
          </div>
        </li>
        <li class="nav-item">
          <div class="profile-dropdown" id="profileDropdown">
            <div class="user-profile-container">
              <div id="userAvatar" class="profile-avatar"></div>
              <span id="userName" class="profile-name">Usuario</span>
            </div>
            <div class="profile-menu">
              <div class="profile-menu-item"><i class="fas fa-user"></i><span>My Profile</span></div>
              <div class="profile-menu-item"><i class="fas fa-history"></i><span>My Orders</span></div>
              <div class="profile-menu-item"><i class="fas fa-cog"></i><span>Settings</span></div>
              <div class="profile-menu-item logout" id="logoutBtn"><i class="fas fa-sign-out-alt"></i><span>Logout</span></div>
            </div>
          </div>
        </li>
      </ul>
    </nav>
  </div>
  <div id="menuOverlay" class="menu-overlay"></div>
</header>

<!-- HERO / Welcome -->
<section class="dashboard-hero">
  <div class="dashboard-welcome">
    <h1 class="dashboard-title">
      WELCOME TO <span class="text-cyan">MADBITE</span>
    </h1>
    <p class="dashboard-subtitle">
      Your personal space to enjoy exclusive benefits, promotions and order
      tracking.
    </p>
  </div>
</section>

<!-- CARDS SECTION -->
<section class="dashboard-sections">
  <div class="dashboard-card">
    <div class="dashboard-card-icon"><i class="fas fa-utensils"></i></div>
    <h3 class="dashboard-card-title">My Orders</h3>
    <div class="dashboard-card-content">
      <p>Review your order history and track your current orders.</p>
    </div>
    <a href="#" class="dashboard-card-button">View Orders</a>
  </div>

  <div class="dashboard-card highlight">
    <div class="dashboard-card-icon"><i class="fas fa-gift"></i></div>
    <h3 class="dashboard-card-title">Promotions</h3>
    <div class="dashboard-card-content">
      <p>
        Discover exclusive member offers and special promotions on our
        products.
      </p>
    </div>
    <a href="promociones.html" class="dashboard-card-button">View Promotions</a>
  </div>

  <div class="dashboard-card">
    <div class="dashboard-card-icon"><i class="fas fa-calendar-alt"></i></div>
    <h3 class="dashboard-card-title">Reservations</h3>
    <div class="dashboard-card-content">
      <p>
        Book a table at any of our locations and manage your existing
        reservations.
      </p>
    </div>
    <a href="#" class="dashboard-card-button">Make Reservation</a>
  </div>

  <div class="dashboard-card">
    <div class="dashboard-card-icon"><i class="fas fa-heart"></i></div>
    <h3 class="dashboard-card-title">My Favorites</h3>
    <div class="dashboard-card-content">
      <p>
        Quickly access your favorite burgers and products for easier
        ordering.
      </p>
    </div>
    <a href="#" class="dashboard-card-button">View Favorites</a>
  </div>

  <div class="dashboard-card">
    <div class="dashboard-card-icon"><i class="fas fa-star"></i></div>
    <h3 class="dashboard-card-title">Loyalty Program</h3>
    <div class="dashboard-card-content">
      <p>
        Check your accumulated points and discover available rewards for
        redemption.
      </p>
    </div>
    <a href="#" class="dashboard-card-button">View Points</a>
  </div>

  <div class="dashboard-card highlight">
    <div class="dashboard-card-icon"><i class="fas fa-user-edit"></i></div>
    <h3 class="dashboard-card-title">My Profile</h3>
    <div class="dashboard-card-content">
      <p>
        Edit your personal information, contact preferences, and payment
        options.
      </p>
    </div>
    <a href="#" class="dashboard-card-button">Edit Profile</a>
  </div>
</section>

<footer class="footer">
  <div class="container">
    <div class="footer-content">
      <div class="footer-brand">
        <img
                src="../assets/images/logo/logo-neon-removebg.png"
                alt="MADBITE Logo"
                class="footer-logo"
        />
        <p class="footer-description">
          MADBITE is a burger chain with style and attitude. Our handcrafted
          burgers and premium quality ingredients make the difference.
        </p>
        <div class="footer-social">

          href="https://www.instagram.com/madbite_usa/"
          class="social-icon"
          aria-label="Instagram"
          target="_blank"
          rel="noopener noreferrer"
          >
          <i class="fab fa-instagram"></i>
          </a>
          <a href="#" class="social-icon" aria-label="Facebook">
            <i class="fab fa-facebook-f"></i>
          </a>
          <a href="#" class="social-icon" aria-label="Twitter">
            <i class="fab fa-twitter"></i>
          </a>

          href="https://www.tiktok.com/@madbite_usa"
          class="social-icon"
          aria-label="TikTok"
          target="_blank"
          rel="noopener noreferrer"
          >
          <i class="fab fa-tiktok"></i>
          </a>
        </div>
      </div>

      <div class="footer-nav">
        <h3 class="footer-heading">Links</h3>
        <ul class="footer-links">
          <li><a href="redireccion.html"><i class="fas fa-chevron-right"></i> Dashboard</a></li>
          <li><a href="menu.html"><i class="fas fa-chevron-right"></i> Menu</a></li>
          <li><a href="comite.html"><i class="fas fa-chevron-right"></i> Committee</a></li>
          <li><a href="../index.html"><i class="fas fa-chevron-right"></i> Home</a></li>
          <li><a href="../index.html#contact"><i class="fas fa-chevron-right"></i> Contact</a></li>
        </ul>
      </div>

      <div class="footer-nav">
        <h3 class="footer-heading">Legal</h3>
        <ul class="footer-links">
          <li><a href="terminos.html"><i class="fas fa-chevron-right"></i> Terms & Conditions</a></li>
          <li><a href="politica.html"><i class="fas fa-chevron-right"></i> Privacy Policy</a></li>
          <li><a href="cookies.html"><i class="fas fa-chevron-right"></i> Cookie Policy</a></li>
          <li><a href="faq.html"><i class="fas fa-chevron-right"></i> FAQ</a></li>
        </ul>
      </div>

      <div class="footer-newsletter">
        <h3 class="footer-heading">Newsletter</h3>
        <p class="newsletter-text">
          Subscribe to receive news and special offers.
        </p>
        <form class="newsletter-form">
          <input
                  type="email"
                  class="newsletter-input"
                  placeholder="Your email"
                  required
          />
          <button type="submit" class="newsletter-btn">
            <i class="fas fa-paper-plane"></i>
          </button>
        </form>
        <p class="form-disclaimer">
          By subscribing you accept our privacy policy.
        </p>
      </div>
    </div>
  </div>

  <div class="copyright">
    <div class="container">
      &copy; 2025 <span>MADBITE</span>. All rights reserved.
    </div>
  </div>
</footer>

<!-- Scroll up -->
<div class="scroll-up" id="scrollUp">
  <i class="fas fa-arrow-up"></i>
</div>

<!-- Script para asegurar que el perfil se carga correctamente -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
          if (!window.AuthService?.isAuthenticated()) return;
          const avatar = document.getElementById("userAvatar");
          const nameEl = document.getElementById("userName");
          if (nameEl && (nameEl.textContent === "" || nameEl.textContent === "Usuario")) {
            window.DashboardFunctions?.loadUserInfo();
          }
    }, 10_000);

    // Verificar periódicamente si los elementos de perfil están presentes
    let profileCheckInterval = setInterval(function() {
      const avatarEl = document.getElementById('userAvatar');
      const nameEl = document.getElementById('userName');

      // Si hay datos de usuario pero los elementos no tienen contenido, intentar cargarlos
      if (avatarEl && nameEl && window.AuthService && window.AuthService.isAuthenticated()) {
        const userData = window.AuthService.getUserData() || {};

        // Nombre de usuario
        if (nameEl.textContent === '' || nameEl.textContent === 'Usuario') {
          let displayName = "Usuario";
          if (userData.name) {
            displayName = userData.name;
          } else if (userData.given_name && userData.family_name) {
            displayName = userData.given_name + " " + userData.family_name;
          } else if (userData.email) {
            displayName = userData.email.split("@")[0];
          } else if (userData.sub) {
            displayName = userData.sub;
          }
          nameEl.textContent = displayName;
        }

        // Avatar
        if (!avatarEl.classList.contains('has-image') && !avatarEl.textContent) {
          const pictureUrl = userData.picture || null;

          if (pictureUrl) {
            const img = document.createElement("img");
            img.src = pictureUrl;
            img.alt = nameEl.textContent + " avatar";
            img.onload = function() {
              avatarEl.innerHTML = '';
              avatarEl.appendChild(img);
              avatarEl.classList.add("has-image");
            };
            img.onerror = function() {
              avatarEl.textContent = nameEl.textContent.charAt(0).toUpperCase();
            };
          } else {
            avatarEl.textContent = nameEl.textContent.charAt(0).toUpperCase();
          }
        }

        // Si ambos elementos tienen contenido, detener el intervalo
        if ((avatarEl.classList.contains('has-image') || avatarEl.textContent) &&
            nameEl.textContent !== '' && nameEl.textContent !== 'Usuario') {
          clearInterval(profileCheckInterval);
        }
      }
    }, 500);

    // Detener el intervalo después de 10 segundos en cualquier caso
    setTimeout(function() {
      clearInterval(profileCheckInterval);
    }, 10000);

    // Configurar el comportamiento del botón de logout
    const logoutBtn = document.getElementById('logoutBtn');
    if (logoutBtn) {
      logoutBtn.addEventListener('click', function(e) {
        e.preventDefault();
        if (window.AuthService) {
          window.AuthService.logout();
        } else {
          // Fallback si AuthService no está disponible
          window.location.href = '../index.html';
        }
      });
    }
  });
</script>
</body>
</html>